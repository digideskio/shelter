<!--
 Copyright 2014 Rafael Dantas Justo. All rights reserved.
 Use of this source code is governed by a GPL
 license that can be found in the LICENSE file.
-->

<article data-ng-init="details = false">
  <header data-ng-click="details = !details"
    data-ng-class="{'domain-error': hasProblems(domain),
      'domain-ok': !hasProblems(domain) && wasChecked(domain)}">
    <h3>{{domain.fqdn}}</h3>
  </header>

  <div class="content" data-ng-show="details && !edit">
    <h4 data-ng-show="domain.nameservers.length > 0" translate>Nameservers</h4>
    <div data-ng-repeat="nameserver in domain.nameservers" class="fieldgroup">
      <div class="field">
        <label translate>Host</label><span>{{nameserver.host}}</span>
      </div>
      <div class="field" data-ng-show="nameserver.ipv4.length > 0">
        <label translate>IPv4</label><span>{{nameserver.ipv4}}</span>
      </div>
      <div class="field" data-ng-show="nameserver.ipv6.length > 0">
        <label translate>IPv6</label><span>{{nameserver.ipv6}}</span>
      </div>
      <div class="field">
        <label translate>Status</label><span>{{nameserver.lastStatus}}</span>
      </div>
      <div class="field" data-ng-show="dateDefined(nameserver.lastCheckAt)">
        <label translate>Checked</label><span>{{nameserver.lastCheckAt | datetime:getLanguage()}}</span>
      </div>
      <div class="field" data-ng-show="dateDefined(nameserver.lastOKAt)">
        <label translate>Last OK</label><span>{{nameserver.lastOKAt | datetime:getLanguage()}}</span>
      </div>
    </div>

    <h4 data-ng-show="domain.dsset.length > 0" translate>DS set</h4>
    <div data-ng-repeat="ds in domain.dsset" class="fieldgroup">
      <div class="field">
        <label translate>Keytag</label><span>{{ds.keytag}}</span>
      </div>
      <div class="field">
        <label translate>Algorithm</label><span>{{getAlgorithm(ds.algorithm)}}</span>
      </div>
      <div class="field">
        <label translate>DigestType</label><span>{{getDSDigestType(ds.digestType)}}</span>
      </div>
      <div class="field">
        <label translate>Digest</label><span>{{showDSDigest(ds.digest)}}</span>
      </div>
      <div class="field">
        <label translate>Status</label><span>{{ds.lastStatus}}</span>
      </div>
      <div class="field" data-ng-show="dateDefined(ds.lastCheckAt)">
        <label translate>Checked</label><span>{{ds.lastCheckAt | datetime:getLanguage()}}</span>
      </div>
      <div class="field" data-ng-show="dateDefined(ds.lastOKAt)">
        <label translate>Last OK</label><span>{{ds.lastOKAt | datetime:getLanguage()}}</span>
      </div>
    </div>

    <h4 data-ng-show="domain.owners.length > 0" translate>Owners</h4>
    <div data-ng-repeat="owner in domain.owners" class="fieldgroup">
      <div class="field">
        <label translate>E-mail</label><span>{{owner.email}}</span>
      </div>
      <div class="field">
        <label translate>Language</label><span>{{owner.language}}</span>
      </div>
    </div>
  </div>

  <div class="buttons" data-ng-show="details && !edit">
    <button type="button" class="big-button"
      data-ng-init="edit = false" data-ng-click="edit = true">
      <i class="fa fa-edit"></i>
      {{ "Edit" | translate }}
    </button>
    <button type="button" class="big-button" data-ng-init="verifyWorking = false"
      data-ng-click="verifyDomain(domain)" data-ng-disabled="verifyWorking">
      <i class="fa fa-spinner fa-2x fa-spin" data-ng-if="verifyWorking"></i>
      <div data-ng-if="!verifyWorking">
        <i class="fa fa-search"></i>
        {{ "Verify" | translate }}
      </div>
    </button>
    <button type="button" class="big-button remove-button"
      data-ng-init="removeWorking = false"
      data-ng-click="removeDomain(domain.fqdn)" data-ng-disabled="removeWorking">
      <i class="fa fa-spinner fa-2x fa-spin" data-ng-if="removeWorking"></i>
      <div data-ng-if="!removeWorking">
        <i class="fa fa-trash-o"></i>
        {{ "Remove" | translate }}
      </div>
    </button>
  </div>

  <div class="message error" data-ng-if="error">{{error}}</div>
  <div class="message success" data-ng-if="success">
    {{success}}

    <h4 data-ng-show="verifyResult.nameservers.length > 0" translate>Nameservers</h4>
    <div data-ng-repeat="nameserver in verifyResult.nameservers" class="fieldgroup">
      <div class="field">
        <label translate>Host</label><span>{{nameserver.host}}</span>
      </div>
      <div class="field">
        <label translate>Status</label><span>{{nameserver.lastStatus}}</span>
      </div>
    </div>

    <h4 data-ng-show="verifyResult.dsset.length > 0" translate>DS set</h4>
    <div data-ng-repeat="ds in verifyResult.dsset" class="fieldgroup">
      <div class="field">
        <label translate>Keytag</label><span>{{ds.keytag}}</span>
      </div>
      <div class="field">
        <label translate>Status</label><span>{{ds.lastStatus}}</span>
      </div>
    </div>
  </div>

  <div class="content-edit" data-ng-show="details && edit">
    <domainform domain="domain"></domainform>
  </div>
</article>